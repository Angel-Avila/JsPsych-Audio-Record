<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/other-plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/other-plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-audio-record.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>
<script>

    /* create timeline */
    var timeline = [];

    timeline.push({
        type: 'html-button-response',
        stimulus: 'Recent versions of Chrome require the user to interact with a page before it can play audio. '+
        'Clicking the button below counts as an interaction. Be aware of this when planning audio experiments if '+
        'you want the first trial to include audio.',
        choices: ['Continue'],
        data: {test_part: 'test'}
    });

    var record = {
        type: "audio-record",
        stimulus: "sound/control_text.mp3",
        prompt: "<p>Listen to this recording and then press the button below to answer the following question.<br />" +
                "What do you remember from the story?</p>",
        data: {test_part: 'record'}
    }
    timeline.push(record);

    var debrief_block = {
        type: "html-keyboard-response",
        stimulus: function() {

            var trials = jsPsych.data.get().filter({test_part: 'record'});
            var audioFiles = trials.select('audio').values;
            const file = audioFiles[0];

            const player = new Audio(URL.createObjectURL(file));
            player.controls = true;

            return player.outerHTML;
        }
    };

    timeline.push(debrief_block);

    var audio = ['sound/control_text.mp3'];

    /* start the experiment */
    jsPsych.init({
        timeline: timeline,
        preload_audio: audio,
        use_webaudio: false,
        on_finish: function(){jsPsych.data.displayData();}
    });
</script>
</html>